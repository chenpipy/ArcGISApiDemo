<!DOCTYPE html>
<html>
    <head>
        <title>FindTask多图层属性查询</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
        <link rel="stylesheet" href="https://js.arcgis.com/3.23/esri/css/esri.css">
        <script src="https://js.arcgis.com/3.23/"></script>
        <style>
            #map{
              position:relative;
              height:500px;
              width:100%;
            }

        </style>
    </head>
    <body>
       <div>
            输入省份或省会名称:
            <input type="text" id="searchText" size="40" value="甘肃省" />
            <input type="button" value="查询" id="find" />
            <div id="tbl"></div>
       </div>
        <div id='map'>

        </div>

        <script>
      require([
      "esri/map",
      "esri/tasks/FindTask",
      "esri/tasks/FindParameters",
      "dojo/_base/array",
      "esri/layers/ArcGISDynamicMapServiceLayer"],
      function (
        Map,
        FindTask,
        FindParameters,
        Array,
        ArcGISDynamicMapServiceLayer) {
        var map = new Map("map", {
                    center: [-100.11289190337,34.7124140046411],
                    zoom:7,
                    basemap: "topo"
                });
        //调用动态地图服务
        // var DyLayer=new ArcGISDynamicMapServiceLayer('http://localhost:6080/arcgis/rest/services/webgis_lesson/ProAndCap/MapServer');
        var dyLayerUrl = "https://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Petroleum/KGS_OilGasFields_Kansas/MapServer"
        let dyLayer=new ArcGISDynamicMapServiceLayer(dyLayerUrl);
        map.addLayer(dyLayer);
        var find = new FindTask("https://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Petroleum/KGS_OilGasFields_Kansas/MapServer");
        let findParameters=new FindParameters();
        findParameters.contains=true;
        findParameters.searchText=document.getElementById("searchText").value;
        var params={
          contains:true,
          searchFields:["FID"],
          returnGeometry:true,
        }
        Object.assign(findParameters,params);
        document.getElementById("find").onclick=doFind;
        function doFind() {
          alert(1)
          params.searchText=document.getElementById("searchText").value;
          find.execute(findParameters,showResults);
        }
        function showResults(results) {
          console.log(1)
          console.log(results)
        }
      });
            </script>
    </body>
</html>
